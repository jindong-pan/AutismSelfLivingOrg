<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è®¤è¯ç³»ç»Ÿæµ‹è¯• - Peaceful Independence</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        input { padding: 8px; margin: 5px; width: 200px; }
    </style>
</head>
<body>
    <h1>ğŸ” è®¤è¯ç³»ç»Ÿè¯Šæ–­å·¥å…·</h1>
    <p>è¿™ä¸ªé¡µé¢å¸®åŠ©æ‚¨è¯Šæ–­æ³¨å†Œ/ç™»å½•åŠŸèƒ½çš„é—®é¢˜ã€‚</p>

    <div id="results"></div>

    <h2>Firebaseé…ç½®æ£€æŸ¥</h2>
    <div id="firebase-status" class="test-result warning">
        ğŸ”„ æ£€æŸ¥ä¸­...
    </div>

    <h2>ç½‘ç»œè¿æ¥æµ‹è¯•</h2>
    <div id="network-status" class="test-result warning">
        ğŸ”„ æ£€æŸ¥ä¸­...
    </div>

    <h2>æ‰‹åŠ¨æµ‹è¯•</h2>
    <div>
        <input type="email" id="test-email" placeholder="æµ‹è¯•é‚®ç®±">
        <input type="password" id="test-password" placeholder="æµ‹è¯•å¯†ç ">
        <button onclick="testRegister()">æµ‹è¯•æ³¨å†Œ</button>
        <button onclick="testLogin()">æµ‹è¯•ç™»å½•</button>
    </div>

    <div id="manual-result" class="test-result" style="display: none;"></div>

    <h2>è§£å†³æ–¹æ¡ˆ</h2>
    <div class="test-result warning">
        <strong>é—®é¢˜è¯Šæ–­ï¼š</strong><br>
        1. å¦‚æœçœ‹åˆ° "Firebaseé…ç½®æœªè®¾ç½®" - éœ€è¦è®¾ç½®Firebaseé¡¹ç›®<br>
        2. å¦‚æœçœ‹åˆ° "ç½‘ç»œè¿æ¥å¤±è´¥" - æ£€æŸ¥ç½‘ç»œè¿æ¥<br>
        3. å¦‚æœçœ‹åˆ°å…¶ä»–é”™è¯¯ - æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°çš„è¯¦ç»†ä¿¡æ¯
    </div>

    <script type="module">
        const resultsDiv = document.getElementById('results');
        const firebaseStatus = document.getElementById('firebase-status');
        const networkStatus = document.getElementById('network-status');

        function addResult(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.textContent = message;
            resultsDiv.appendChild(div);
        }

        // æ£€æŸ¥Firebaseé…ç½®
        async function checkFirebaseConfig() {
            try {
                // å°è¯•å¯¼å…¥Firebase - è¿™ä¼šå‘Šè¯‰æˆ‘ä»¬é…ç½®æ˜¯å¦æ­£ç¡®
                const { initializeApp } = await import('https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js');

                // æ£€æŸ¥é…ç½®å¸¸é‡
                const config = {
                    apiKey: "AIzaSyDz3DtqF6RuJoKiRfcznepfO5zyXwcKMLc",
                    authDomain: "peaceful-independence.firebaseapp.com",
                    projectId: "peaceful-independence",
                    storageBucket: "peaceful-independence.firebasestorage.app",
                    messagingSenderId: "989115528458",
                    appId: "1:989115528458:web:36615bf180d2110d1576f3",
                    measurementId: "G-30HKN7XFT5"
                };

                // æ£€æŸ¥æ˜¯å¦æœ‰å ä½ç¬¦
                const hasPlaceholder = Object.values(config).some(value =>
                    typeof value === 'string' && value.includes('your-'));

                if (hasPlaceholder) {
                    firebaseStatus.className = 'test-result error';
                    firebaseStatus.innerHTML = 'âŒ Firebaseé…ç½®æœªè®¾ç½®<br>' +
                        'è¯·æŒ‰ç…§ <code>AUTH_SETUP_README.md</code> ä¸­çš„è¯´æ˜è®¾ç½®Firebaseé¡¹ç›®ï¼Œå¹¶æ›´æ–°æ‰€æœ‰é¡µé¢ä¸­çš„é…ç½®ã€‚';
                    return false;
                }

                // å°è¯•åˆå§‹åŒ–Firebase
                const app = initializeApp(config);
                firebaseStatus.className = 'test-result success';
                firebaseStatus.textContent = 'âœ… Firebaseé…ç½®æ­£ç¡®';
                return true;

            } catch (error) {
                firebaseStatus.className = 'test-result error';
                firebaseStatus.innerHTML = `âŒ Firebaseåˆå§‹åŒ–å¤±è´¥: ${error.message}`;
                return false;
            }
        }

        // æ£€æŸ¥ç½‘ç»œè¿æ¥
        async function checkNetwork() {
            try {
                const response = await fetch('https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js', {
                    method: 'HEAD',
                    mode: 'no-cors'
                });
                networkStatus.className = 'test-result success';
                networkStatus.textContent = 'âœ… ç½‘ç»œè¿æ¥æ­£å¸¸';
                return true;
            } catch (error) {
                networkStatus.className = 'test-result error';
                networkStatus.textContent = 'âŒ ç½‘ç»œè¿æ¥å¤±è´¥ - æ£€æŸ¥ç½‘ç»œè¿æ¥';
                return false;
            }
        }

        // æµ‹è¯•æ³¨å†ŒåŠŸèƒ½
        window.testRegister = async function() {
            const email = document.getElementById('test-email').value;
            const password = document.getElementById('test-password').value;

            if (!email || !password) {
                showManualResult('è¯·è¾“å…¥é‚®ç®±å’Œå¯†ç ', 'error');
                return;
            }

            try {
                const { initializeApp } = await import('https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js');
                const { getAuth, createUserWithEmailAndPassword } = await import('https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js');

                const config = {
                    apiKey: "AIzaSyDz3DtqF6RuJoKiRfcznepfO5zyXwcKMLc",
                    authDomain: "peaceful-independence.firebaseapp.com",
                    projectId: "peaceful-independence",
                    storageBucket: "peaceful-independence.firebasestorage.app",
                    messagingSenderId: "989115528458",
                    appId: "1:989115528458:web:36615bf180d2110d1576f3",
                    measurementId: "G-30HKN7XFT5"
                };

                const app = initializeApp(config);
                const auth = getAuth(app);

                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                showManualResult('æ³¨å†ŒæˆåŠŸï¼', 'success');

            } catch (error) {
                showManualResult(`æ³¨å†Œå¤±è´¥: ${error.message}`, 'error');
            }
        };

        // æµ‹è¯•ç™»å½•åŠŸèƒ½
        window.testLogin = async function() {
            const email = document.getElementById('test-email').value;
            const password = document.getElementById('test-password').value;

            if (!email || !password) {
                showManualResult('è¯·è¾“å…¥é‚®ç®±å’Œå¯†ç ', 'error');
                return;
            }

            try {
                const { initializeApp } = await import('https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js');
                const { getAuth, signInWithEmailAndPassword } = await import('https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js');

                const config = {
                    apiKey: "AIzaSyDz3DtqF6RuJoKiRfcznepfO5zyXwcKMLc",
                    authDomain: "peaceful-independence.firebaseapp.com",
                    projectId: "peaceful-independence",
                    storageBucket: "peaceful-independence.firebasestorage.app",
                    messagingSenderId: "989115528458",
                    appId: "1:989115528458:web:36615bf180d2110d1576f3",
                    measurementId: "G-30HKN7XFT5"
                };

                const app = initializeApp(config);
                const auth = getAuth(app);

                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                showManualResult('ç™»å½•æˆåŠŸï¼', 'success');

            } catch (error) {
                showManualResult(`ç™»å½•å¤±è´¥: ${error.message}`, 'error');
            }
        };

        function showManualResult(message, type) {
            const resultDiv = document.getElementById('manual-result');
            resultDiv.className = `test-result ${type}`;
            resultDiv.textContent = message;
            resultDiv.style.display = 'block';
        }

        // é¡µé¢åŠ è½½æ—¶è¿è¡Œæ£€æŸ¥
        window.addEventListener('load', async () => {
            addResult('ğŸ” å¼€å§‹è¯Šæ–­è®¤è¯ç³»ç»Ÿ...', 'info');
            await checkNetwork();
            await checkFirebaseConfig();
            addResult('âœ… è¯Šæ–­å®Œæˆ', 'success');
        });
    </script>
</body>
</html>
